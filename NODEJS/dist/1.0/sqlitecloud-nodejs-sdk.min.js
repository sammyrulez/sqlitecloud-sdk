/*! For license information please see sqlitecloud-nodejs-sdk.min.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("tls"),require("lz4")):"function"==typeof define&&define.amd?define(["tls","lz4"],e):"object"==typeof exports?exports.SQLiteCloud=e(require("tls"),require("lz4")):t.SQLiteCloud=e(t.tls,t.lz4)}(this,((t,e)=>(()=>{var r={763:(t,e,r)=>{t.exports=r(774).default},774:(t,e,r)=>{"use strict";r.d(e,{default:()=>l});const s=r(535);var n=r(43);const i=(t="SQLiteCloud",e)=>{const r=new Date,s=`0 ${r.getDate()}`.slice(-2),n=`0${r.getMonth()+1}`.slice(-2),i=`${r.getFullYear()}/${n}/${s} ${r.getHours()}:${r.getMinutes()}:${r.getSeconds()}:${r.getMilliseconds()}`;console.log(`!!!!!!!!! ${t}: ${i} - ${e}`)},a=t=>":"!=t&&","!=t&&"_"!=t,o=t=>parseInt(t.subarray(1,t.indexOf(" ")).toString("utf8")),u=t=>{var e=t.indexOf(" ");t=t.subarray(e+1,t.length);var r=parseInt(t.subarray(0,t.indexOf(" ")+1).toString("utf8"));t=t.subarray(t.indexOf(" ")+1,t.length);var s=parseInt(t.subarray(0,t.indexOf(" ")+1).toString("utf8")),i=(t=t.subarray(t.indexOf(" ")+1,t.length)).subarray(0,1).toString("utf8"),a=Buffer.alloc(s),o=n.decodeBlock(t.subarray(t.length-r,t.length),a);if(t=Buffer.concat([t.subarray(0,t.length-r),a]),o<=0||o!==s)throw new Error(`lz4 uncompression error error at offset ${o}`);return{buffer:t,dataType:i}},d=t=>{var e,r=Array.isArray(t)?t[0].subarray(0,1).toString("utf8"):t.subarray(0,1).toString("utf8"),s=t.indexOf(" ");if("%"===r)if(Array.isArray(t))for(var n=0;n<t.length;n++){const e=u(t[n]);t[n]=e.buffer,r=e.dataType}else{const e=u(t);t=e.buffer,r=e.dataType}switch(r){case":":e=parseInt(t.subarray(1,t.length-1).toString("utf8"));break;case",":e=parseFloat(t.subarray(1,t.length-1).toString("utf8"));break;case"_":e=null;break;case"+":case"^":e=t.subarray(s+1,t.length).toString("utf8");break;case"!":e=t.subarray(s+1,t.length-1).toString("utf8");break;case"#":e=JSON.parse(t.subarray(s+1,t.length).toString("utf8"));break;case"$":e=t.subarray(s+1,t.length);break;case"-":const u=t.subarray(s+1,t.length);var i=u.subarray(0,u.indexOf(" ")),l="0",c="-1";-1!==i.indexOf(":")&&(-1!==(l=i.subarray(i.indexOf(":")+1,i.length)).indexOf(":")&&(c=l.subarray(l.indexOf(":")+1,l.length).toString("utf8"),l=l.subarray(0,l.indexOf(":"))),l=l.toString("utf8"),i=i.subarray(0,i.indexOf(":")).toString("utf8"));const I=u.subarray(u.indexOf(" ")+1,u.length).toString("utf8");var f=new Error(I);throw f.code=parseInt(i),f.extErrCode=parseInt(l),f.offsetCode=parseInt(c),f;case"=":const C=t.subarray(s+1,t.length),v=parseInt(C.subarray(0,s-2).toString("utf8"));var g=C.subarray(C.indexOf(" ")+1,C.length);if(e=[],v>0)for(n=0;n<v;n++){const t=g.subarray(0,1).toString("utf8");if(a(t)){const t=o(g);e.push(d(g.subarray(0,g.indexOf(" ")+1+t))),g=g.subarray(g.indexOf(" ")+1+t,g.length)}else e.push(d(g.subarray(0,g.indexOf(" ")))),g=g.subarray(g.indexOf(" ")+1,g.length)}break;case"*":var b=t.subarray(s+1,t.length),y=parseInt(b.subarray(b.indexOf(":")+1,b.indexOf(" ")+1).toString("utf8"));b=b.subarray(b.indexOf(" ")+1,b.length);var m=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8"));b=b.subarray(b.indexOf(" ")+1,b.length);var p=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8"));b=b.subarray(b.indexOf(" ")+1,b.length);var O=[];for(n=0;n<p;n++){b.subarray(0,1).toString("utf8");const t=o(b);O.push(d(b.subarray(0,b.indexOf(" ")+1+t))),b=b.subarray(b.indexOf(" ")+1+t,b.length)}for(var S=[],x=0;x<m*p;x++){const t=b.subarray(0,1).toString("utf8");if(a(t)){const t=o(b);S.push(b.subarray(0,b.indexOf(" ")+1+t)),b=b.subarray(b.indexOf(" ")+1+t,b.length)}else S.push(b.subarray(0,b.indexOf(" "))),b=b.subarray(b.indexOf(" ")+1,b.length)}e=new h({version:y,nRows:m,nCols:p,colsName:O,data:S});break;case"/":for(m=0,p=0,O=[],S=[],n=0;n<t.length;n++){s=(b=t[n]).indexOf(" ");b=b.subarray(s+1,b.length);var T=parseInt(b.subarray(0,b.indexOf(" ")).toString("utf8"));y=parseInt(b.subarray(b.indexOf(":")+1,b.indexOf(" ")).toString("utf8")),b=b.subarray(b.indexOf(" ")+1,b.length);var E=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8"));if(m+=E,b=b.subarray(b.indexOf(" ")+1,b.length),p=parseInt(b.subarray(0,b.indexOf(" ")+1).toString("utf8")),b=b.subarray(b.indexOf(" ")+1,b.length),1===T)for(x=0;x<p;x++){b.subarray(0,1).toString("utf8");const t=o(b);O.push(d(b.subarray(0,b.indexOf(" ")+1+t))),b=b.subarray(b.indexOf(" ")+1+t,b.length)}for(var w=0;w<E*p;w++){const t=b.subarray(0,1).toString("utf8");if(a(t)){const t=o(b);S.push(b.subarray(0,b.indexOf(" ")+1+t)),b=b.subarray(b.indexOf(" ")+1+t,b.length)}else S.push(b.subarray(0,b.indexOf(" "))),b=b.subarray(b.indexOf(" ")+1,b.length)}}return new h({version:y,nRows:m,nCols:p,colsName:O,data:S});default:throw e=`Data type${r} is not defined in SCSP`,console.log(`Data type${r} is not defined in SCSP`),new TypeError(`Data type${r} is not defined in SCSP`)}return e};class h{#t=[];version;nRows=0;nCols=0;colsName=[];constructor(t){this.#t=t.data,this.version=t.version,this.nRows=t.nRows,this.nCols=t.nCols,this.colsName=t.colsName}get version(){return this.version}get nRows(){return this.nRows}get nCols(){return this.nCols}#e(t,e){return!(t>=this.nRows||e>=this.nCols)}getItem(t,e){if(this.#e(t,e)){const r=this.#t[t*this.nCols+e];return d(r)}throw new RangeError(`row value has to be less than ${this.nRows} and col value has to be less than ${this.nCols}`)}dump(){for(var t=[],e=0;e<this.nRows;e++){for(var r="| ",s=0;s<this.nCols;s++)r=r+this.getItem(e,s)+" | ";t.push(r)}return t}}class l{#r=null;#s="";#n=null;#i=null;#a={};#o=null;#u=null;#d=null;#h=3e5;#l=!1;constructor(t,e=!1){this.#l=e,this.#s=t.clientId,t.connectionString||(this.#n=t.host,this.#i=t.port,this.#a=t.tlsOptions?t.tlsOptions:{},this.#o=t.user,this.#u=t.password,this.#d=`AUTH USER ${this.#o} ${t.passwordHashed?"HASH":"PASSWORD"} ${this.#u};`,t.database&&(t.dbCreate&&!t.dbMemory&&(this.#d+=`CREATE DATABASE ${t.database} IF NOT EXISTS;`),this.#d+=`USE DATABASE ${t.database};`),t.sqliteMode&&(this.#d+="SET CLIENT KEY SQLITE TO 1;"),t.compression&&(this.#d+="SET CLIENT KEY COMPRESSION TO 1;"),t.zeroText&&(this.#d+="SET CLIENT KEY ZEROTEXT TO 1;"),t.nonlinearizable&&(this.#d+="SET CLIENT KEY NONLINEARIZABLE TO 1;"),t.noBlob&&(this.#d+="SET CLIENT KEY NOBLOB TO 1;"),t.maxData&&(this.#d+=`SET CLIENT KEY MAXDATA TO ${maxData};`),t.maxRows&&(this.#d+=`SET CLIENT KEY MAXROWS TO ${maxRows};`),t.maxRowset&&(this.#d+=`SET CLIENT KEY MAXROWSET TO ${maxRowset};`)),t.queryTimeout&&(this.#h=t.queryTimeout)}#c(t){return`+${Buffer.byteLength(t,"utf-8")} ${t}`}#f(t,e){return t.length-t.indexOf(" ")-1==e}connect(){return new Promise(((t,e)=>{if(!this.#o||!this.#u){var r=new TypeError('The "config.user" or "config.password" argument must be specified');r.code="ERR_MISSING_ARGS",e(r)}var n;this.#h&&("number"!=typeof this.#h?(n=new TypeError('The "config.queryTimeout" must be one of type number. Received '+typeof this.#h)).code="ERR_INVALID_ARG_TYPE":this.#h<0&&((n=new RangeError('The "config.queryTimeout" must be greater then 0. Received '+this.#h)).code="ERR_INVALID_ARG_RANGE"),n&&e(n));var a=new s.connect(this.#i,this.#n,this.#a,(async()=>{if(a.authorized){this.#l&&i(this.#s,"connection authorized"),this.#l&&i(this.#s,"sending init commands: "+this.#d);try{this.#r=a;const e=await this.sendCommands(this.#d);t(e)}catch(t){i(this.#s,"initCommandsResponse error"),e(t)}}else this.#l&&i(this.#s,"connection NOT authorized"),e(new Error("Connection NOT authorized",{cause:a.authorizationError}))})).on("close",(()=>{this.#l&&i(this.#s,"connection closed")})).on("end",(()=>{this.#l&&i(this.#s,"end connection")})).once("error",(t=>{this.#l&&i(this.#s,"received error"),this.#l&&console.log(t),a.destroy(),e(new Error("Connection on error event",{cause:t}))}))}))}sendCommands(t){t=this.#c(t);var e=Buffer.alloc(0),r=[];return this.#l&&i(this.#s,"recevied new command to be sent: "+t),new Promise(((s,n)=>{var u;const h=t=>{this.#l&&i(this.#s,"onData event: "+t);const l=0===e.length?t.subarray(0,1).toString("utf8"):e.subarray(0,1).toString("utf8");e=Buffer.concat([e,t]);const c=a(l);if(this.#l&&i(this.#s,"New data has command LEN? "+c),c){var f;if(f=o(e),this.#l&&i(this.#s,"Reading new data with LEN: "+f),"%"===l)var g=e.subarray(e.indexOf(" ")+1,e.length),b=(g=(g=g.subarray(g.indexOf(" ")+1,g.length)).subarray(g.indexOf(" ")+1,g.length)).subarray(0,1).toString("utf8");if(this.#f(e,f))if("/"!==l&&"/"!==b){this.#r.off("data",h),clearTimeout(u);try{const t=d(e);s(t)}catch(t){n(t)}}else if("0 0 0 "===t.subarray(t.indexOf(" ")+1,t.length).toString("utf8")){clearTimeout(u);try{const t=d(r);s(t)}catch(t){n(t)}}else r.push(e),e=Buffer.alloc(0),this.#r.write(this.#c("OK"))}else{const t=e.subarray(e.length-1,e.length).toString("utf8");if(this.#l&&i(this.#s,"Reading new data without command LEN")," "==t){this.#l&&i(this.#s,"Reading complete, endining with space"),this.#r.off("data",h),clearTimeout(u);try{const t=d(e);s(t)}catch(t){n(t)}}}};this.#r.write(t,"utf8",(()=>{u=setTimeout((()=>{this.#r.off("data",h),clearTimeout(u),n(new Error("Request timed out",{cause:t}))}),this.#h),this.#r.on("data",h)})),this.#r.once("error",(t=>{this.#l&&i(this.#s,"received error"),this.#l&&console.log(t),client.destroy(),n(new Error("Connection on error event",{cause:t}))}))}))}}},43:t=>{"use strict";t.exports=e},535:e=>{"use strict";e.exports=t}},s={};function n(t){var e=s[t];if(void 0!==e)return e.exports;var i=s[t]={exports:{}};return r[t](i,i.exports,n),i.exports}return n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n(763)})()));
//# sourceMappingURL=sqlitecloud-nodejs-sdk.min.js.map